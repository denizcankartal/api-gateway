#############################################################
############# Define your backend services here #############
#############################################################
#
# upstream my_service {
#     least_conn;
#     keepalive 32;
#     keepalive_timeout 60s;
#     keepalive_requests 100;
#
#     server my-service:8080 max_fails=3 fail_timeout=30s;
#     server my-service-2:8080 max_fails=3 fail_timeout=30s;
# }

upstream market_service {
    least_conn;
    keepalive 32;
    keepalive_timeout 60s;
    keepalive_requests 100;

    # Multiple instances for high-traffic market data
    server market-service:8080 max_fails=3 fail_timeout=30s;
    server market-service-2:8080 max_fails=3 fail_timeout=30s;
}

upstream order_service {
    least_conn;
    keepalive 32;
    keepalive_timeout 60s;
    keepalive_requests 100;

    # Multiple instances for critical order handling
    server order-service:8080 max_fails=3 fail_timeout=30s;
    server order-service-2:8080 max_fails=3 fail_timeout=30s;
}

upstream portfolio_service {
    least_conn;
    keepalive 32;
    keepalive_timeout 60s;
    keepalive_requests 100;

    server portfolio-service:8080 max_fails=3 fail_timeout=30s;
}